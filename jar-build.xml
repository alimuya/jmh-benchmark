<project name="jmh-ant" default="jmh-jar" basedir=".">
    <property name="lib" location="lib"/>
    <property name="src" location="src"/>
    <property name="build" location="bin"/>
    <property name="dist" location="dist"/>
    <property name="test-reg-exp" value=".*"/>

    <target name="jmh-jar" description="Generate the self-contained JAR">
        <delete dir="${build}"/>
        <mkdir dir="${build}"/>

        <javac srcdir="${src}" destdir="${build}">
            <classpath>
                <fileset dir="${lib}">
                    <include name="**/*.jar"/>
                </fileset>
            </classpath>
        </javac>
        
        <delete file="${dist}/benchmarks.jar "/>
        <delete dir="${dist} "/>
        <mkdir dir="${dist}"/>

        <jar jarfile="${dist}/benchmarks.jar" basedir="${build}">
			<restrict>
				<name name="**/*.class" />
				<archives>
					<zips>
						<fileset dir="${lib}" includes="**/*.jar" />
					</zips>
				</archives>
			</restrict>
            
            <manifest>
                <attribute name="Main-Class" value="org.openjdk.jmh.Main"/>
            </manifest>
        </jar>
        
    </target>

    <target name="clean" description="Clean">
        <delete dir="${build}"/>
        <delete dir="${dist}"/>
    </target>

    <target name="benchmark" description="Run tests generated by JMH" depends="jmh-jar">
        <java jar="${dist}/benchmarks.jar" fork="true">
            <arg value="${test-reg-exp}"/>
        </java>
    </target>
</project>

